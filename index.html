<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Persona Clock</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            overflow-x: hidden;
        }
        #root {
            width: 100%;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        @media (max-width: 768px) {
            #root {
                padding: 5px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // ÏïÑÏù¥ÏΩò Ïª¥Ìè¨ÎÑåÌä∏Îì§
        const SettingsIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
                <circle cx="12" cy="12" r="3"/>
            </svg>
        );

        const PlusIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
        );

        const XIcon = () => (
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        );

        const PaletteIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="13.5" cy="6.5" r=".5"/>
                <circle cx="17.5" cy="10.5" r=".5"/>
                <circle cx="8.5" cy="7.5" r=".5"/>
                <circle cx="6.5" cy="12.5" r=".5"/>
                <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"/>
            </svg>
        );

        const EditIcon = () => (
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
        );

        const DownloadIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
        );

        const ChartIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="18" y1="20" x2="18" y2="10"/>
                <line x1="12" y1="20" x2="12" y2="4"/>
                <line x1="6" y1="20" x2="6" y2="14"/>
            </svg>
        );

        const CopyIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
            </svg>
        );

        const PersonaClock = () => {
            const [currentTime, setCurrentTime] = useState(new Date());
            const [showSettings, setShowSettings] = useState(false);
            const [activeTab, setActiveTab] = useState('personas');
            const [resetHour, setResetHour] = useState(5);
            const [theme, setTheme] = useState('light');
            const [personas, setPersonas] = useState([]);
            
            // Ïä§ÏºÄÏ§Ñ Î™®Îìú Í¥ÄÎ†® ÏÉÅÌÉú
            const [scheduleMode, setScheduleMode] = useState('daily'); // 'daily' or 'weekly'
            const [dailySchedule, setDailySchedule] = useState([]);
            const [weeklySchedule, setWeeklySchedule] = useState({
                monday: [],
                tuesday: [],
                wednesday: [],
                thursday: [],
                friday: [],
                saturday: [],
                sunday: []
            });
            const [selectedDay, setSelectedDay] = useState('monday');
            
            const [newPersonaName, setNewPersonaName] = useState('');
            const [newPersonaColor, setNewPersonaColor] = useState('#6366f1');
            const [showColorPicker, setShowColorPicker] = useState(false);
            
            const [newStartHour, setNewStartHour] = useState(9);
            const [newStartMinute, setNewStartMinute] = useState(0);
            const [newEndHour, setNewEndHour] = useState('');
            const [newEndMinute, setNewEndMinute] = useState('');
            const [newPersona, setNewPersona] = useState('');
            const [newGoal, setNewGoal] = useState('');
            const [editingIndex, setEditingIndex] = useState(null);
            const [showStats, setShowStats] = useState(false);

            const colorPresets = [
                '#6366f1', '#8b5cf6', '#ec4899', '#ef4444',
                '#f59e0b', '#84cc16', '#10b981', '#14b8a6',
                '#06b6d4', '#3b82f6', '#6366f1', '#a855f7'
            ];

            const dayNames = {
                monday: 'Ïõî',
                tuesday: 'Ìôî',
                wednesday: 'Ïàò',
                thursday: 'Î™©',
                friday: 'Í∏à',
                saturday: 'ÌÜ†',
                sunday: 'Ïùº'
            };

            const themes = {
                space: {
                    bg: 'linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%)',
                    text: '#f1f5f9',
                    textMuted: '#94a3b8',
                    cardBg: 'rgba(255,255,255,0.05)',
                    border: 'rgba(255,255,255,0.1)',
                    clockBg: '#1f2937',
                    clockLine: '#4b5563'
                },
                dark: {
                    bg: 'linear-gradient(135deg, #18181b 0%, #27272a 100%)',
                    text: '#fafafa',
                    textMuted: '#a1a1aa',
                    cardBg: 'rgba(255,255,255,0.03)',
                    border: 'rgba(255,255,255,0.08)',
                    clockBg: '#3f3f46',
                    clockLine: '#71717a'
                },
                light: {
                    bg: 'linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%)',
                    text: '#18181b',
                    textMuted: '#71717a',
                    cardBg: 'rgba(0,0,0,0.02)',
                    border: 'rgba(0,0,0,0.1)',
                    clockBg: '#e5e5e5',
                    clockLine: '#a1a1aa'
                }
            };

            const themeOptions = [
                { key: 'light', label: 'ÎùºÏù¥Ìä∏', icon: '‚òÄÔ∏è' },
                { key: 'dark', label: 'Îã§ÌÅ¨', icon: 'üåô' },
                { key: 'space', label: 'Ïö∞Ï£º', icon: '‚ú®' }
            ];

            const currentTheme = themes[theme];

            // ÌòÑÏû¨ ÏöîÏùº Í∞ÄÏ†∏Ïò§Í∏∞
            const getCurrentDayKey = () => {
                const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
                return days[new Date().getDay()];
            };

            // Ïò§Îäò ÌëúÏãúÌï† Ïä§ÏºÄÏ§Ñ Í∞ÄÏ†∏Ïò§Í∏∞
            const getTodaySchedule = () => {
                if (scheduleMode === 'daily') {
                    return dailySchedule;
                } else {
                    const dayKey = getCurrentDayKey();
                    return weeklySchedule[dayKey] || [];
                }
            };

            // ÌòÑÏû¨ Ìé∏Ïßë Ï§ëÏù∏ Ïä§ÏºÄÏ§Ñ Í∞ÄÏ†∏Ïò§Í∏∞
            const getCurrentEditingSchedule = () => {
                if (scheduleMode === 'daily') {
                    return dailySchedule;
                } else {
                    return weeklySchedule[selectedDay] || [];
                }
            };

            // Ïä§ÏºÄÏ§Ñ ÏóÖÎç∞Ïù¥Ìä∏
            const updateSchedule = (newSchedule) => {
                if (scheduleMode === 'daily') {
                    setDailySchedule(newSchedule);
                } else {
                    setWeeklySchedule({
                        ...weeklySchedule,
                        [selectedDay]: newSchedule
                    });
                }
            };

            useEffect(() => {
                const timer = setInterval(() => setCurrentTime(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            useEffect(() => {
                const saved = localStorage.getItem('personaClock');
                if (saved) {
                    const data = JSON.parse(saved);
                    setPersonas(data.personas || []);
                    setScheduleMode(data.scheduleMode || 'daily');
                    setDailySchedule(data.dailySchedule || []);
                    setWeeklySchedule(data.weeklySchedule || {
                        monday: [], tuesday: [], wednesday: [], thursday: [],
                        friday: [], saturday: [], sunday: []
                    });
                    setTheme(data.theme || 'light');
                    setResetHour(data.resetHour || 5);
                }
                
                const lastReset = localStorage.getItem('lastResetDate');
                const today = new Date().toDateString();
                
                if (lastReset !== today) {
                    checkAndResetSchedule();
                }
            }, []);

            useEffect(() => {
                const checkReset = setInterval(() => {
                    const now = new Date();
                    const currentHour = now.getHours();
                    const currentMinute = now.getMinutes();
                    
                    if (currentHour === resetHour && currentMinute === 0) {
                        const lastReset = localStorage.getItem('lastResetDate');
                        const today = now.toDateString();
                        
                        if (lastReset !== today) {
                            checkAndResetSchedule();
                        }
                    }
                }, 60000);
                
                return () => clearInterval(checkReset);
            }, [resetHour, scheduleMode]);

            const checkAndResetSchedule = () => {
                const now = new Date();
                const currentHour = now.getHours();
                
                if (currentHour >= resetHour) {
                    // Îß§Ïùº Î≥ÄÍ≤Ω Î™®ÎìúÏùº ÎïåÎßå Î¶¨ÏÖã
                    if (scheduleMode === 'daily') {
                        setDailySchedule([]);
                    }
                    // ÏùºÏ£ºÏùº Í≥†Ï†ï Î™®ÎìúÎäî Î¶¨ÏÖãÌïòÏßÄ ÏïäÏùå
                    localStorage.setItem('lastResetDate', now.toDateString());
                }
            };

            useEffect(() => {
                localStorage.setItem('personaClock', JSON.stringify({
                    personas,
                    scheduleMode,
                    dailySchedule,
                    weeklySchedule,
                    theme,
                    resetHour
                }));
            }, [personas, scheduleMode, dailySchedule, weeklySchedule, theme, resetHour]);

            const getScheduleWithEndTimes = (schedule) => {
                const sorted = [...schedule].sort((a, b) => 
                    (a.startHour * 60 + a.startMinute) - (b.startHour * 60 + b.startMinute)
                );
                
                return sorted.map((seg, i) => {
                    const next = sorted[i + 1];
                    const endHour = seg.endHour !== null ? seg.endHour : (next ? next.startHour : 24);
                    const endMinute = seg.endMinute !== null ? seg.endMinute : (next ? next.startMinute : 0);
                    
                    return {
                        ...seg,
                        calculatedEndHour: endHour,
                        calculatedEndMinute: endMinute
                    };
                });
            };

            const getCurrentSegment = () => {
                const now = currentTime.getHours() * 60 + currentTime.getMinutes();
                const todaySchedule = getTodaySchedule();
                const scheduleWithEnd = getScheduleWithEndTimes(todaySchedule);
                
                for (let seg of scheduleWithEnd) {
                    const startMinutes = seg.startHour * 60 + seg.startMinute;
                    const endMinutes = seg.calculatedEndHour * 60 + seg.calculatedEndMinute;
                    
                    if (now >= startMinutes && now < endMinutes) {
                        const persona = personas.find(p => p.name === seg.personaName);
                        const remaining = endMinutes - now;
                        return {
                            persona: persona || { name: seg.personaName, color: '#6b7280' },
                            goal: seg.goal,
                            remaining,
                            startMinutes,
                            endMinutes
                        };
                    }
                }
                return null;
            };

            const addPersona = () => {
                if (newPersonaName.trim()) {
                    setPersonas([...personas, { name: newPersonaName, color: newPersonaColor }]);
                    setNewPersonaName('');
                    setNewPersonaColor('#6366f1');
                    setShowColorPicker(false);
                }
            };

            const removePersona = (index) => {
                setPersonas(personas.filter((_, i) => i !== index));
            };

            const addScheduleItem = () => {
                if (newPersona) {
                    const newItem = {
                        startHour: newStartHour,
                        startMinute: newStartMinute,
                        endHour: newEndHour === '' ? null : parseInt(newEndHour),
                        endMinute: newEndMinute === '' ? null : parseInt(newEndMinute),
                        personaName: newPersona,
                        goal: newGoal
                    };
                    
                    const currentSchedule = getCurrentEditingSchedule();
                    
                    if (editingIndex !== null) {
                        const updated = [...currentSchedule];
                        updated[editingIndex] = newItem;
                        updateSchedule(updated.sort((a, b) => 
                            (a.startHour * 60 + a.startMinute) - (b.startHour * 60 + b.startMinute)
                        ));
                        setEditingIndex(null);
                    } else {
                        updateSchedule([...currentSchedule, newItem].sort((a, b) => 
                            (a.startHour * 60 + a.startMinute) - (b.startHour * 60 + b.startMinute)
                        ));
                    }
                    
                    setNewStartHour(9);
                    setNewStartMinute(0);
                    setNewEndHour('');
                    setNewEndMinute('');
                    setNewPersona('');
                    setNewGoal('');
                }
            };

            const editScheduleItem = (index) => {
                const currentSchedule = getCurrentEditingSchedule();
                const item = currentSchedule[index];
                setNewStartHour(item.startHour);
                setNewStartMinute(item.startMinute);
                setNewEndHour(item.endHour !== null ? item.endHour : '');
                setNewEndMinute(item.endMinute !== null ? item.endMinute : '');
                setNewPersona(item.personaName);
                setNewGoal(item.goal);
                setEditingIndex(index);
            };

            const removeScheduleItem = (index) => {
                const currentSchedule = getCurrentEditingSchedule();
                updateSchedule(currentSchedule.filter((_, i) => i !== index));
            };

            const captureImage = async () => {
                const element = document.getElementById('clock-container');
                if (!element) {
                    alert('ÏãúÍ≥Ñ ÌôîÎ©¥ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                }
                
                if (typeof html2canvas === 'undefined') {
                    alert('Ïù¥ÎØ∏ÏßÄ Ï∫°Ï≤ò ÎùºÏù¥Î∏åÎü¨Î¶¨Î•º Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }
                
                try {
                    const canvas = await html2canvas(element, {
                        backgroundColor: theme === 'light' ? '#ffffff' : (theme === 'dark' ? '#18181b' : '#0f172a'),
                        scale: 2,
                        logging: false,
                        useCORS: true,
                        allowTaint: true
                    });
                    
                    try {
                        const dataUrl = canvas.toDataURL('image/png');
                        const link = document.createElement('a');
                        link.download = `persona-clock-${new Date().toISOString().split('T')[0]}.png`;
                        link.href = dataUrl;
                        link.click();
                        return;
                    } catch (e) {
                        console.log('dataURL Î∞©Ïãù Ïã§Ìå®, blob ÏãúÎèÑ');
                    }
                    
                    canvas.toBlob((blob) => {
                        if (!blob) {
                            alert('Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                            return;
                        }
                        const url = URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.download = `persona-clock-${new Date().toISOString().split('T')[0]}.png`;
                        link.href = url;
                        link.click();
                        setTimeout(() => URL.revokeObjectURL(url), 100);
                    }, 'image/png');
                    
                } catch (error) {
                    console.error('Image capture failed:', error);
                    alert('Ïù¥ÎØ∏ÏßÄ Ï∫°Ï≤òÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. Î∏åÎùºÏö∞Ï†ÄÏóêÏÑú ÏßÅÏ†ë Ïó¥Ïñ¥ÏÑú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                }
            };

            const exportData = () => {
                try {
                    const data = {
                        personas,
                        scheduleMode,
                        dailySchedule,
                        weeklySchedule,
                        theme,
                        resetHour,
                        exportDate: new Date().toISOString()
                    };
                    
                    const jsonString = JSON.stringify(data, null, 2);
                    
                    try {
                        const blob = new Blob([jsonString], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = `persona-clock-backup-${new Date().toISOString().split('T')[0]}.json`;
                        link.click();
                        setTimeout(() => URL.revokeObjectURL(url), 100);
                        return;
                    } catch (e) {
                        console.log('Blob Î∞©Ïãù Ïã§Ìå®, dataURL ÏãúÎèÑ');
                    }
                    
                    const dataUrl = 'data:application/json;charset=utf-8,' + encodeURIComponent(jsonString);
                    const link = document.createElement('a');
                    link.href = dataUrl;
                    link.download = `persona-clock-backup-${new Date().toISOString().split('T')[0]}.json`;
                    link.click();
                    
                } catch (error) {
                    console.error('Export failed:', error);
                    alert('ÌååÏùº Îã§Ïö¥Î°úÎìúÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨ Î≤ÑÌäºÏùÑ ÏÇ¨Ïö©Ìï¥Ï£ºÏÑ∏Ïöî.');
                }
            };

            const copyBackupData = () => {
                try {
                    const data = {
                        personas,
                        scheduleMode,
                        dailySchedule,
                        weeklySchedule,
                        theme,
                        resetHour,
                        exportDate: new Date().toISOString()
                    };
                    
                    const jsonString = JSON.stringify(data, null, 2);
                    
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        navigator.clipboard.writeText(jsonString).then(() => {
                            alert('‚úÖ Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞Í∞Ä ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!\n\nÎ©îÎ™®Ïû•Ïóê Î∂ôÏó¨ÎÑ£Ïñ¥ .json ÌååÏùºÎ°ú Ï†ÄÏû•ÌïòÏÑ∏Ïöî.');
                        }).catch(() => {
                            fallbackCopy(jsonString);
                        });
                    } else {
                        fallbackCopy(jsonString);
                    }
                } catch (error) {
                    console.error('Copy failed:', error);
                    alert('Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }
            };
            
            const fallbackCopy = (text) => {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    alert('‚úÖ Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞Í∞Ä ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!\n\nÎ©îÎ™®Ïû•Ïóê Î∂ôÏó¨ÎÑ£Ïñ¥ .json ÌååÏùºÎ°ú Ï†ÄÏû•ÌïòÏÑ∏Ïöî.');
                } catch (err) {
                    alert('Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }
                document.body.removeChild(textArea);
            };

            const importData = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (data.personas) setPersonas(data.personas);
                        if (data.scheduleMode) setScheduleMode(data.scheduleMode);
                        if (data.dailySchedule) setDailySchedule(data.dailySchedule);
                        if (data.weeklySchedule) setWeeklySchedule(data.weeklySchedule);
                        if (data.theme) setTheme(data.theme);
                        if (data.resetHour !== undefined) setResetHour(data.resetHour);
                        alert('‚úÖ Îç∞Ïù¥ÌÑ∞Î•º ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î≥µÍµ¨ÌñàÏäµÎãàÎã§!');
                    } catch (error) {
                        alert('‚ùå ÌååÏùºÏùÑ ÏùΩÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                    }
                };
                reader.readAsText(file);
                e.target.value = '';
            };

            const getTodayStats = () => {
                const todaySchedule = getTodaySchedule();
                const scheduleWithEnd = getScheduleWithEndTimes(todaySchedule);
                const stats = {};
                let total = 0;
                
                scheduleWithEnd.forEach(seg => {
                    const duration = (seg.calculatedEndHour * 60 + seg.calculatedEndMinute) - 
                                   (seg.startHour * 60 + seg.startMinute);
                    stats[seg.personaName] = (stats[seg.personaName] || 0) + duration;
                    total += duration;
                });
                
                return Object.entries(stats).map(([name, minutes]) => ({
                    name,
                    minutes,
                    percentage: ((minutes / total) * 100).toFixed(1),
                    color: personas.find(p => p.name === name)?.color || '#6b7280'
                })).sort((a, b) => b.minutes - a.minutes);
            };

            const drawClock = () => {
                const isMobile = window.innerWidth <= 768;
                const size = isMobile ? Math.min(window.innerWidth - 60, 280) : 340;
                const center = size / 2;
                const outerRadius = size / 2 - 25;
                const innerRadius = size / 3.5;
                const currentSegment = getCurrentSegment();
                const todaySchedule = getTodaySchedule();
                const scheduleWithEnd = getScheduleWithEndTimes(todaySchedule);

                const elements = [];

                elements.push(
                    <circle key="outer" cx={center} cy={center} r={outerRadius} fill="none" stroke={currentTheme.clockBg} strokeWidth="1" />,
                    <circle key="inner" cx={center} cy={center} r={innerRadius} fill="none" stroke={currentTheme.clockBg} strokeWidth="1" />
                );

                for (let i = 0; i < 24; i++) {
                    const angle = (i * 15 - 90) * Math.PI / 180;
                    const x1 = center + (outerRadius - 8) * Math.cos(angle);
                    const y1 = center + (outerRadius - 8) * Math.sin(angle);
                    const x2 = center + outerRadius * Math.cos(angle);
                    const y2 = center + outerRadius * Math.sin(angle);
                    const textX = center + (outerRadius + 12) * Math.cos(angle);
                    const textY = center + (outerRadius + 12) * Math.sin(angle);
                    
                    elements.push(
                        <g key={`hour-${i}`}>
                            <line x1={x1} y1={y1} x2={x2} y2={y2} stroke={currentTheme.clockLine} strokeWidth="1" />
                            <text x={textX} y={textY} textAnchor="middle" dominantBaseline="middle" fill={currentTheme.textMuted} fontSize={isMobile ? "9" : "10"}>
                                {i}
                            </text>
                        </g>
                    );
                }

                scheduleWithEnd.forEach((seg, i) => {
                    const startAngle = ((seg.startHour + seg.startMinute / 60) * 15 - 90) * Math.PI / 180;
                    const endAngle = ((seg.calculatedEndHour + seg.calculatedEndMinute / 60) * 15 - 90) * Math.PI / 180;
                    
                    const persona = personas.find(p => p.name === seg.personaName);
                    const color = persona?.color || '#6b7280';
                    
                    const now = currentTime.getHours() * 60 + currentTime.getMinutes();
                    const segStart = seg.startHour * 60 + seg.startMinute;
                    const segEnd = seg.calculatedEndHour * 60 + seg.calculatedEndMinute;
                    const isActive = now >= segStart && now < segEnd;

                    const x1 = center + innerRadius * Math.cos(startAngle);
                    const y1 = center + innerRadius * Math.sin(startAngle);
                    const x2 = center + outerRadius * Math.cos(startAngle);
                    const y2 = center + outerRadius * Math.sin(startAngle);
                    const x3 = center + outerRadius * Math.cos(endAngle);
                    const y3 = center + outerRadius * Math.sin(endAngle);
                    const x4 = center + innerRadius * Math.cos(endAngle);
                    const y4 = center + innerRadius * Math.sin(endAngle);

                    const largeArc = endAngle - startAngle > Math.PI ? 1 : 0;

                    elements.push(
                        <path
                            key={`seg-${i}`}
                            d={`M ${x1} ${y1} L ${x2} ${y2} A ${outerRadius} ${outerRadius} 0 ${largeArc} 1 ${x3} ${y3} L ${x4} ${y4} A ${innerRadius} ${innerRadius} 0 ${largeArc} 0 ${x1} ${y1}`}
                            fill={color}
                            opacity={isActive ? 1 : 0.6}
                            stroke={isActive ? (theme === 'light' ? '#000' : '#fff') : 'none'}
                            strokeWidth={isActive ? 2 : 0}
                            style={{
                                filter: isActive ? `drop-shadow(0 0 6px ${color})` : 'none'
                            }}
                        />
                    );
                });

                const hour = currentTime.getHours() + currentTime.getMinutes() / 60;
                const angle = (hour * 15 - 90) * Math.PI / 180;
                const x = center + (outerRadius - 5) * Math.cos(angle);
                const y = center + (outerRadius - 5) * Math.sin(angle);
                const pointerColor = theme === 'light' ? '#000' : '#fff';
                
                elements.push(
                    <g key="pointer">
                        <line x1={center} y1={center} x2={x} y2={y} stroke={pointerColor} strokeWidth="2" />
                        <circle cx={x} cy={y} r="5" fill={pointerColor} />
                        <circle cx={center} cy={center} r="6" fill={pointerColor} />
                    </g>
                );

                return <svg width={size} height={size} style={{ margin: '15px auto', display: 'block', maxWidth: '100%' }}>{elements}</svg>;
            };

            const current = getCurrentSegment();
            const hours = current ? Math.floor(current.remaining / 60) : 0;
            const minutes = current ? current.remaining % 60 : 0;
            const todaySchedule = getTodaySchedule();

            return (
                <div style={{ 
                    background: currentTheme.bg, 
                    minHeight: '100vh',
                    width: '100%',
                    color: currentTheme.text,
                    fontFamily: 'system-ui, -apple-system, sans-serif',
                    padding: '15px',
                    boxSizing: 'border-box'
                }}>
                    <div style={{ maxWidth: '480px', margin: '0 auto', width: '100%' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '15px' }}>
                            <h1 style={{ fontSize: '20px', fontWeight: '600', margin: 0 }}>Persona Clock</h1>
                            <div style={{ display: 'flex', gap: '6px' }}>
                                {todaySchedule.length > 0 && (
                                    <button 
                                        onClick={() => {
                                            setShowStats(!showStats);
                                            setShowSettings(false);
                                        }}
                                        style={{ 
                                            background: showStats ? '#6366f1' : currentTheme.cardBg, 
                                            border: 'none', 
                                            padding: '8px', 
                                            borderRadius: '8px',
                                            cursor: 'pointer',
                                            color: showStats ? '#fff' : currentTheme.text,
                                            display: 'flex',
                                            alignItems: 'center'
                                        }}
                                        title="ÌÜµÍ≥Ñ Î≥¥Í∏∞"
                                    >
                                        <ChartIcon />
                                    </button>
                                )}
                                <button 
                                    onClick={captureImage}
                                    style={{ 
                                        background: currentTheme.cardBg, 
                                        border: 'none', 
                                        padding: '8px', 
                                        borderRadius: '8px',
                                        cursor: 'pointer',
                                        color: currentTheme.text,
                                        display: 'flex',
                                        alignItems: 'center'
                                    }}
                                    title="Ïù¥ÎØ∏ÏßÄÎ°ú Ï†ÄÏû•"
                                >
                                    <DownloadIcon />
                                </button>
                                <button 
                                    onClick={() => {
                                        setShowSettings(!showSettings);
                                        setShowStats(false);
                                    }}
                                    style={{ 
                                        background: showSettings ? '#6366f1' : currentTheme.cardBg, 
                                        border: 'none', 
                                        padding: '8px', 
                                        borderRadius: '8px',
                                        cursor: 'pointer',
                                        color: showSettings ? '#fff' : currentTheme.text,
                                        display: 'flex',
                                        alignItems: 'center'
                                    }}
                                >
                                    <SettingsIcon />
                                </button>
                            </div>
                        </div>

                        {!showSettings && !showStats ? (
                            <div id="clock-container"
                                style={{
                                    background: currentTheme.bg,
                                    padding: '15px',
                                    borderRadius: '12px'
                                }}
                            >
                                <div style={{ textAlign: 'center', fontSize: '24px', fontWeight: '600', marginBottom: '8px' }}>
                                    {currentTime.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', second: '2-digit' })}
                                </div>

                                {drawClock()}

                                {current && (
                                    <div style={{ 
                                        background: currentTheme.cardBg, 
                                        padding: '15px', 
                                        borderRadius: '10px',
                                        marginTop: '15px',
                                        border: `2px solid ${current.persona.color}`
                                    }}>
                                        <div style={{ fontSize: '22px', fontWeight: '600', marginBottom: '8px', color: current.persona.color }}>
                                            {current.persona.name}
                                        </div>
                                        {current.goal && (
                                            <div style={{ fontSize: '14px', marginBottom: '8px', color: currentTheme.textMuted }}>
                                                üéØ {current.goal}
                                            </div>
                                        )}
                                        <div style={{ fontSize: '16px', color: currentTheme.textMuted }}>
                                            ‚è±Ô∏è {hours > 0 ? `${hours}ÏãúÍ∞Ñ ` : ''}{minutes}Î∂Ñ ÎÇ®Ïùå
                                        </div>
                                    </div>
                                )}

                                {todaySchedule.length === 0 && (
                                    <div style={{ 
                                        background: currentTheme.cardBg, 
                                        padding: '25px', 
                                        borderRadius: '10px',
                                        marginTop: '15px',
                                        textAlign: 'center'
                                    }}>
                                        <div style={{ fontSize: '18px', marginBottom: '8px' }}>üëã</div>
                                        <div style={{ fontSize: '14px', color: currentTheme.textMuted }}>
                                            ÏÑ§Ï†ïÏóêÏÑú ÌéòÎ•¥ÏÜåÎÇòÏôÄ ÏùºÏ†ïÏùÑ Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî
                                        </div>
                                    </div>
                                )}

                                {todaySchedule.length > 0 && (
                                    <div style={{ marginTop: '15px' }}>
                                        <div style={{ fontSize: '13px', color: currentTheme.textMuted, marginBottom: '8px' }}>Today's Flow</div>
                                        {getScheduleWithEndTimes(todaySchedule).map((seg, i) => {
                                            const persona = personas.find(p => p.name === seg.personaName);
                                            const color = persona?.color || '#6b7280';
                                            const isActive = current && seg.personaName === current.persona.name;
                                            
                                            return (
                                                <div key={i} style={{ 
                                                    display: 'flex', 
                                                    alignItems: 'center', 
                                                    gap: '8px',
                                                    padding: '6px',
                                                    background: isActive ? currentTheme.cardBg : 'transparent',
                                                    borderRadius: '6px',
                                                    marginBottom: '3px'
                                                }}>
                                                    <div style={{ 
                                                        width: '10px', 
                                                        height: '10px', 
                                                        borderRadius: '50%', 
                                                        background: color,
                                                        flexShrink: 0
                                                    }} />
                                                    <div style={{ fontSize: '13px', color: isActive ? currentTheme.text : currentTheme.textMuted }}>
                                                        {String(seg.startHour).padStart(2, '0')}:{String(seg.startMinute).padStart(2, '0')} - {String(seg.calculatedEndHour).padStart(2, '0')}:{String(seg.calculatedEndMinute).padStart(2, '0')} {seg.personaName}
                                                        {seg.goal && <span style={{ color: currentTheme.textMuted }}> ‚Ä¢ {seg.goal}</span>}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>
                        ) : showStats ? (
                            <div>
                                <h2 style={{ fontSize: '18px', fontWeight: '600', marginBottom: '15px', marginTop: 0 }}>Ïò§ÎäòÏùò ÌÜµÍ≥Ñ</h2>
                                {getTodayStats().map((stat, i) => {
                                    const hours = Math.floor(stat.minutes / 60);
                                    const mins = stat.minutes % 60;
                                    
                                    return (
                                        <div key={i} style={{ marginBottom: '15px' }}>
                                            <div style={{ 
                                                display: 'flex', 
                                                justifyContent: 'space-between', 
                                                marginBottom: '6px',
                                                alignItems: 'center'
                                            }}>
                                                <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                                    <div style={{ 
                                                        width: '14px', 
                                                        height: '14px', 
                                                        borderRadius: '50%', 
                                                        background: stat.color 
                                                    }} />
                                                    <span style={{ fontSize: '15px', fontWeight: '500' }}>{stat.name}</span>
                                                </div>
                                                <div style={{ fontSize: '13px', color: currentTheme.textMuted }}>
                                                    {hours > 0 && `${hours}ÏãúÍ∞Ñ `}{mins}Î∂Ñ ‚Ä¢ {stat.percentage}%
                                                </div>
                                            </div>
                                            <div style={{ 
                                                width: '100%', 
                                                height: '8px', 
                                                background: currentTheme.cardBg, 
                                                borderRadius: '4px',
                                                overflow: 'hidden'
                                            }}>
                                                <div style={{ 
                                                    width: `${stat.percentage}%`, 
                                                    height: '100%', 
                                                    background: stat.color,
                                                    transition: 'width 0.3s ease'
                                                }} />
                                            </div>
                                        </div>
                                    );
                                })}

                                {getTodayStats().length === 0 && (
                                    <div style={{ 
                                        textAlign: 'center', 
                                        padding: '35px', 
                                        color: currentTheme.textMuted 
                                    }}>
                                        ÏùºÏ†ïÏùÑ Ï∂îÍ∞ÄÌïòÎ©¥ ÌÜµÍ≥ÑÍ∞Ä ÌëúÏãúÎê©ÎãàÎã§
                                    </div>
                                )}
                            </div>
                        ) : (
                            <div>
                                <div style={{ display: 'flex', gap: '6px', marginBottom: '15px', borderBottom: `1px solid ${currentTheme.border}`, overflowX: 'auto' }}>
                                    {[
                                        { key: 'personas', label: 'ÌéòÎ•¥ÏÜåÎÇò' },
                                        { key: 'schedule', label: 'ÏùºÏ†ï' },
                                        { key: 'theme', label: 'ÌÖåÎßà' },
                                        { key: 'backup', label: 'Î∞±ÏóÖ/Î≥µÍµ¨' }
                                    ].map(tab => (
                                        <button
                                            key={tab.key}
                                            onClick={() => setActiveTab(tab.key)}
                                            style={{
                                                padding: '10px 15px',
                                                background: 'transparent',
                                                border: 'none',
                                                borderBottom: activeTab === tab.key ? `2px solid #6366f1` : '2px solid transparent',
                                                cursor: 'pointer',
                                                color: activeTab === tab.key ? currentTheme.text : currentTheme.textMuted,
                                                fontWeight: activeTab === tab.key ? '600' : 'normal',
                                                fontSize: '13px',
                                                whiteSpace: 'nowrap'
                                            }}
                                        >
                                            {tab.label}
                                        </button>
                                    ))}
                                </div>

                                {activeTab === 'personas' && (
                                    <div>
                                        <h3 style={{ fontSize: '16px', marginBottom: '12px', marginTop: 0 }}>ÌéòÎ•¥ÏÜåÎÇò Í¥ÄÎ¶¨</h3>
                                        <div style={{ display: 'flex', gap: '8px', marginBottom: '12px' }}>
                                            <input
                                                type="text"
                                                value={newPersonaName}
                                                onChange={(e) => setNewPersonaName(e.target.value)}
                                                placeholder="ÌéòÎ•¥ÏÜåÎÇò Ïù¥Î¶Ñ"
                                                style={{ 
                                                    flex: 1,
                                                    padding: '9px',
                                                    background: currentTheme.cardBg,
                                                    border: `1px solid ${currentTheme.border}`,
                                                    borderRadius: '6px',
                                                    color: currentTheme.text,
                                                    fontSize: '14px'
                                                }}
                                            />
                                            <button
                                                onClick={() => setShowColorPicker(!showColorPicker)}
                                                style={{ 
                                                    padding: '9px',
                                                    background: newPersonaColor,
                                                    border: 'none',
                                                    borderRadius: '6px',
                                                    cursor: 'pointer',
                                                    width: '45px',
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center'
                                                }}
                                            >
                                                <PaletteIcon />
                                            </button>
                                            <button
                                                onClick={addPersona}
                                                style={{ 
                                                    padding: '9px',
                                                    background: '#6366f1',
                                                    border: 'none',
                                                    borderRadius: '6px',
                                                    cursor: 'pointer',
                                                    color: '#fff',
                                                    display: 'flex',
                                                    alignItems: 'center'
                                                }}
                                            >
                                                <PlusIcon />
                                            </button>
                                        </div>

                                        {showColorPicker && (
                                            <div style={{ 
                                                display: 'grid', 
                                                gridTemplateColumns: 'repeat(6, 1fr)', 
                                                gap: '6px',
                                                marginBottom: '12px',
                                                padding: '10px',
                                                background: currentTheme.cardBg,
                                                borderRadius: '8px'
                                            }}>
                                                {colorPresets.map(color => (
                                                    <button
                                                        key={color}
                                                        onClick={() => {
                                                            setNewPersonaColor(color);
                                                            setShowColorPicker(false);
                                                        }}
                                                        style={{
                                                            width: '35px',
                                                            height: '35px',
                                                            background: color,
                                                            border: newPersonaColor === color ? '3px solid #fff' : 'none',
                                                            borderRadius: '6px',
                                                            cursor: 'pointer'
                                                        }}
                                                    />
                                                ))}
                                            </div>
                                        )}
                                        
                                        {personas.map((persona, i) => (
                                            <div key={i} style={{ 
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '8px',
                                                padding: '9px',
                                                background: currentTheme.cardBg,
                                                borderRadius: '6px',
                                                marginBottom: '6px'
                                            }}>
                                                <div style={{ 
                                                    width: '18px',
                                                    height: '18px',
                                                    borderRadius: '50%',
                                                    background: persona.color
                                                }} />
                                                <div style={{ flex: 1, fontSize: '14px' }}>{persona.name}</div>
                                                <button
                                                    onClick={() => removePersona(i)}
                                                    style={{ 
                                                        background: 'transparent',
                                                        border: 'none',
                                                        cursor: 'pointer',
                                                        color: '#ef4444',
                                                        padding: '4px',
                                                        display: 'flex',
                                                        alignItems: 'center'
                                                    }}
                                                >
                                                    <XIcon />
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                )}

                                {activeTab === 'schedule' && (
                                    <div>
                                        <div style={{ marginBottom: '15px' }}>
                                            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '10px' }}>
                                                <h3 style={{ fontSize: '16px', margin: 0 }}>ÏùºÏ†ï Í¥ÄÎ¶¨</h3>
                                                
                                                {/* ÌÜ†Í∏Ä Ïä§ÏúÑÏπò */}
                                                <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                                    <span style={{ fontSize: '12px', color: currentTheme.textMuted }}>Îß§Ïùº Î≥ÄÍ≤Ω</span>
                                                    <div 
                                                        onClick={() => setScheduleMode(scheduleMode === 'daily' ? 'weekly' : 'daily')}
                                                        style={{
                                                            width: '44px',
                                                            height: '24px',
                                                            background: scheduleMode === 'weekly' ? '#6366f1' : currentTheme.border,
                                                            borderRadius: '12px',
                                                            padding: '2px',
                                                            cursor: 'pointer',
                                                            transition: 'background 0.3s ease',
                                                            position: 'relative'
                                                        }}
                                                    >
                                                        <div style={{
                                                            width: '20px',
                                                            height: '20px',
                                                            background: '#fff',
                                                            borderRadius: '50%',
                                                            transition: 'transform 0.3s ease',
                                                            transform: scheduleMode === 'weekly' ? 'translateX(20px)' : 'translateX(0)'
                                                        }} />
                                                    </div>
                                                    <span style={{ fontSize: '12px', color: currentTheme.textMuted }}>Í≥†Ï†ï</span>
                                                </div>
                                            </div>
                                            
                                            {/* ÏùºÏ£ºÏùº Í≥†Ï†ï Î™®ÎìúÏùº Îïå ÏöîÏùº ÏÑ†ÌÉù ÌÉ≠ */}
                                            {scheduleMode === 'weekly' && (
                                                <div style={{ 
                                                    display: 'flex', 
                                                    gap: '4px', 
                                                    marginBottom: '12px',
                                                    overflowX: 'auto',
                                                    paddingBottom: '4px'
                                                }}>
                                                    {Object.keys(dayNames).map(day => (
                                                        <button
                                                            key={day}
                                                            onClick={() => setSelectedDay(day)}
                                                            style={{
                                                                padding: '6px 12px',
                                                                background: selectedDay === day ? '#6366f1' : currentTheme.cardBg,
                                                                border: 'none',
                                                                borderRadius: '6px',
                                                                cursor: 'pointer',
                                                                color: selectedDay === day ? '#fff' : currentTheme.text,
                                                                fontSize: '13px',
                                                                fontWeight: selectedDay === day ? '600' : 'normal',
                                                                whiteSpace: 'nowrap'
                                                            }}
                                                        >
                                                            {dayNames[day]}
                                                        </button>
                                                    ))}
                                                </div>
                                            )}
                                        </div>

                                        <div style={{ 
                                            background: currentTheme.cardBg, 
                                            padding: '12px', 
                                            borderRadius: '8px',
                                            marginBottom: '12px'
                                        }}>
                                            <div style={{ marginBottom: '8px' }}>
                                                <label style={{ fontSize: '11px', color: currentTheme.textMuted, display: 'block', marginBottom: '4px' }}>ÏãúÏûë ÏãúÍ∞Ñ</label>
                                                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '8px' }}>
                                                    <select
                                                        value={newStartHour}
                                                        onChange={(e) => setNewStartHour(parseInt(e.target.value))}
                                                        style={{
                                                            padding: '7px',
                                                            background: currentTheme.cardBg,
                                                            border: `1px solid ${currentTheme.border}`,
                                                            borderRadius: '6px',
                                                            color: currentTheme.text,
                                                            fontSize: '13px'
                                                        }}
                                                    >
                                                        {[...Array(24)].map((_, i) => (
                                                            <option key={i} value={i} style={{ background: '#fff', color: '#000' }}>{String(i).padStart(2, '0')}Ïãú</option>
                                                        ))}
                                                    </select>
                                                    <select
                                                        value={newStartMinute}
                                                        onChange={(e) => setNewStartMinute(parseInt(e.target.value))}
                                                        style={{
                                                            padding: '7px',
                                                            background: currentTheme.cardBg,
                                                            border: `1px solid ${currentTheme.border}`,
                                                            borderRadius: '6px',
                                                            color: currentTheme.text,
                                                            fontSize: '13px'
                                                        }}
                                                    >
                                                        {[0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55].map(m => (
                                                            <option key={m} value={m} style={{ background: '#fff', color: '#000' }}>{String(m).padStart(2, '0')}Î∂Ñ</option>
                                                        ))}
                                                    </select>
                                                </div>
                                            </div>

                                            <div style={{ marginBottom: '8px' }}>
                                                <label style={{ fontSize: '11px', color: currentTheme.textMuted, display: 'block', marginBottom: '4px' }}>Ï¢ÖÎ£å ÏãúÍ∞Ñ (ÏÑ†ÌÉù)</label>
                                                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '8px' }}>
                                                    <select
                                                        value={newEndHour}
                                                        onChange={(e) => setNewEndHour(e.target.value)}
                                                        style={{
                                                            padding: '7px',
                                                            background: currentTheme.cardBg,
                                                            border: `1px solid ${currentTheme.border}`,
                                                            borderRadius: '6px',
                                                            color: currentTheme.text,
                                                            fontSize: '13px'
                                                        }}
                                                    >
                                                        <option value="" style={{ background: '#fff', color: '#000' }}>ÏûêÎèô</option>
                                                        {[...Array(24)].map((_, i) => (
                                                            <option key={i} value={i} style={{ background: '#fff', color: '#000' }}>{String(i).padStart(2, '0')}Ïãú</option>
                                                        ))}
                                                    </select>
                                                    <select
                                                        value={newEndMinute}
                                                        onChange={(e) => setNewEndMinute(e.target.value)}
                                                        style={{
                                                            padding: '7px',
                                                            background: currentTheme.cardBg,
                                                            border: `1px solid ${currentTheme.border}`,
                                                            borderRadius: '6px',
                                                            color: currentTheme.text,
                                                            fontSize: '13px'
                                                        }}
                                                    >
                                                        <option value="" style={{ background: '#fff', color: '#000' }}>ÏûêÎèô</option>
                                                        {[0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55].map(m => (
                                                            <option key={m} value={m} style={{ background: '#fff', color: '#000' }}>{String(m).padStart(2, '0')}Î∂Ñ</option>
                                                        ))}
                                                    </select>
                                                </div>
                                            </div>

                                            <div style={{ marginBottom: '8px' }}>
                                                <label style={{ fontSize: '11px', color: currentTheme.textMuted, display: 'block', marginBottom: '4px' }}>ÌéòÎ•¥ÏÜåÎÇò</label>
                                                <select
                                                    value={newPersona}
                                                    onChange={(e) => setNewPersona(e.target.value)}
                                                    style={{
                                                        width: '100%',
                                                        padding: '7px',
                                                        background: currentTheme.cardBg,
                                                        border: `1px solid ${currentTheme.border}`,
                                                        borderRadius: '6px',
                                                        color: currentTheme.text,
                                                        fontSize: '13px'
                                                    }}
                                                >
                                                    <option value="" style={{ background: '#fff', color: '#000' }}>ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                                                    {personas.map((p, i) => (
                                                        <option key={i} value={p.name} style={{ background: '#fff', color: '#000' }}>{p.name}</option>
                                                    ))}
                                                </select>
                                            </div>

                                            <div style={{ marginBottom: '8px' }}>
                                                <label style={{ fontSize: '11px', color: currentTheme.textMuted, display: 'block', marginBottom: '4px' }}>Î™©Ìëú (ÏÑ†ÌÉù)</label>
                                                <input
                                                    type="text"
                                                    value={newGoal}
                                                    onChange={(e) => setNewGoal(e.target.value)}
                                                    placeholder="Ïòà: ÎÖºÎ¨∏ 2Í∞ú ÏùΩÍ∏∞"
                                                    style={{
                                                        width: '100%',
                                                        padding: '7px',
                                                        background: currentTheme.cardBg,
                                                        border: `1px solid ${currentTheme.border}`,
                                                        borderRadius: '6px',
                                                        color: currentTheme.text,
                                                        fontSize: '13px',
                                                        boxSizing: 'border-box'
                                                    }}
                                                />
                                            </div>

                                            <button
                                                onClick={addScheduleItem}
                                                style={{
                                                    width: '100%',
                                                    padding: '9px',
                                                    background: '#6366f1',
                                                    border: 'none',
                                                    borderRadius: '6px',
                                                    cursor: 'pointer',
                                                    color: '#fff',
                                                    fontWeight: '600',
                                                    fontSize: '13px'
                                                }}
                                            >
                                                {editingIndex !== null ? 'ÏùºÏ†ï ÏàòÏ†ï' : 'ÏùºÏ†ï Ï∂îÍ∞Ä'}
                                            </button>
                                        </div>

                                        <div>
                                            {getScheduleWithEndTimes(getCurrentEditingSchedule()).map((seg, i) => {
                                                const persona = personas.find(p => p.name === seg.personaName);
                                                const color = persona?.color || '#6b7280';
                                                
                                                return (
                                                    <div key={i} style={{ 
                                                        display: 'flex',
                                                        alignItems: 'center',
                                                        gap: '8px',
                                                        padding: '10px',
                                                        background: currentTheme.cardBg,
                                                        borderRadius: '6px',
                                                        marginBottom: '6px'
                                                    }}>
                                                        <div style={{ 
                                                            width: '14px',
                                                            height: '14px',
                                                            borderRadius: '50%',
                                                            background: color,
                                                            flexShrink: 0
                                                        }} />
                                                        <div style={{ flex: 1, fontSize: '13px' }}>
                                                            <div style={{ fontWeight: '600' }}>
                                                                {String(seg.startHour).padStart(2, '0')}:{String(seg.startMinute).padStart(2, '0')} - {String(seg.calculatedEndHour).padStart(2, '0')}:{String(seg.calculatedEndMinute).padStart(2, '0')}
                                                            </div>
                                                            <div style={{ marginTop: '3px' }}>{seg.personaName}</div>
                                                            {seg.goal && <div style={{ fontSize: '11px', color: currentTheme.textMuted, marginTop: '2px' }}>{seg.goal}</div>}
                                                        </div>
                                                        <button
                                                            onClick={() => editScheduleItem(i)}
                                                            style={{ 
                                                                background: 'transparent',
                                                                border: 'none',
                                                                cursor: 'pointer',
                                                                color: currentTheme.textMuted,
                                                                padding: '4px',
                                                                display: 'flex',
                                                                alignItems: 'center'
                                                            }}
                                                        >
                                                            <EditIcon />
                                                        </button>
                                                        <button
                                                            onClick={() => removeScheduleItem(i)}
                                                            style={{ 
                                                                background: 'transparent',
                                                                border: 'none',
                                                                cursor: 'pointer',
                                                                color: '#ef4444',
                                                                padding: '4px',
                                                                display: 'flex',
                                                                alignItems: 'center'
                                                            }}
                                                        >
                                                            <XIcon />
                                                        </button>
                                                    </div>
                                                );
                                            })}
                                        </div>

                                        {scheduleMode === 'daily' && (
                                            <div style={{ marginTop: '25px' }}>
                                                <h3 style={{ fontSize: '16px', marginBottom: '12px' }}>ÏùºÏ†ï Î¶¨ÏÖã ÏãúÍ∞Ñ</h3>
                                                <div style={{ 
                                                    background: currentTheme.cardBg, 
                                                    padding: '12px', 
                                                    borderRadius: '8px'
                                                }}>
                                                    <div style={{ fontSize: '12px', color: currentTheme.textMuted, marginBottom: '8px' }}>
                                                        Îß§Ïùº Ïù¥ ÏãúÍ∞ÑÏóê ÏùºÏ†ïÌëúÍ∞Ä Ï¥àÍ∏∞ÌôîÎê©ÎãàÎã§
                                                    </div>
                                                    <select
                                                        value={resetHour}
                                                        onChange={(e) => setResetHour(parseInt(e.target.value))}
                                                        style={{
                                                            width: '100%',
                                                            padding: '9px',
                                                            background: currentTheme.cardBg,
                                                            border: `1px solid ${currentTheme.border}`,
                                                            borderRadius: '6px',
                                                            color: currentTheme.text,
                                                            fontSize: '14px'
                                                        }}
                                                    >
                                                        {[...Array(24)].map((_, i) => (
                                                            <option key={i} value={i} style={{ background: '#fff', color: '#000' }}>
                                                                {String(i).padStart(2, '0')}:00 {i < 12 ? 'Ïò§Ï†Ñ' : 'Ïò§ÌõÑ'}
                                                            </option>
                                                        ))}
                                                    </select>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {activeTab === 'theme' && (
                                    <div>
                                        <h3 style={{ fontSize: '16px', marginBottom: '12px', marginTop: 0 }}>ÌÖåÎßà ÏÑ†ÌÉù</h3>
                                        <div style={{ display: 'flex', gap: '8px' }}>
                                            {themeOptions.map(t => (
                                                <button
                                                    key={t.key}
                                                    onClick={() => setTheme(t.key)}
                                                    style={{
                                                        flex: 1,
                                                        padding: '14px',
                                                        background: theme === t.key ? '#6366f1' : currentTheme.cardBg,
                                                        border: `1px solid ${currentTheme.border}`,
                                                        borderRadius: '10px',
                                                        cursor: 'pointer',
                                                        color: currentTheme.text,
                                                        fontWeight: theme === t.key ? '600' : 'normal',
                                                        fontSize: '14px',
                                                        display: 'flex',
                                                        flexDirection: 'column',
                                                        alignItems: 'center',
                                                        gap: '6px'
                                                    }}
                                                >
                                                    <span style={{ fontSize: '20px' }}>{t.icon}</span>
                                                    <span>{t.label}</span>
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {activeTab === 'backup' && (
                                    <div>
                                        <h3 style={{ fontSize: '16px', marginBottom: '12px', marginTop: 0 }}>Î∞±ÏóÖ & Î≥µÍµ¨</h3>
                                        
                                        <div style={{ 
                                            background: currentTheme.cardBg, 
                                            padding: '15px', 
                                            borderRadius: '8px',
                                            marginBottom: '15px'
                                        }}>
                                            <h4 style={{ fontSize: '14px', marginBottom: '8px', marginTop: 0 }}>Îç∞Ïù¥ÌÑ∞ Î∞±ÏóÖ</h4>
                                            <p style={{ fontSize: '12px', color: currentTheme.textMuted, marginBottom: '12px', lineHeight: '1.5' }}>
                                                Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞Î•º Î≥µÏÇ¨ÌïòÍ±∞ÎÇò ÌååÏùºÎ°ú Îã§Ïö¥Î°úÎìúÌïòÏÑ∏Ïöî.
                                            </p>
                                            <div style={{ display: 'flex', gap: '8px' }}>
                                                <button
                                                    onClick={copyBackupData}
                                                    style={{
                                                        flex: 1,
                                                        padding: '10px',
                                                        background: '#6366f1',
                                                        border: 'none',
                                                        borderRadius: '6px',
                                                        cursor: 'pointer',
                                                        color: '#fff',
                                                        fontWeight: '600',
                                                        fontSize: '13px',
                                                        display: 'flex',
                                                        alignItems: 'center',
                                                        justifyContent: 'center',
                                                        gap: '6px'
                                                    }}
                                                >
                                                    <CopyIcon /> Î≥µÏÇ¨
                                                </button>
                                                <button
                                                    onClick={exportData}
                                                    style={{
                                                        flex: 1,
                                                        padding: '10px',
                                                        background: currentTheme.cardBg,
                                                        border: `1px solid ${currentTheme.border}`,
                                                        borderRadius: '6px',
                                                        cursor: 'pointer',
                                                        color: currentTheme.text,
                                                        fontWeight: '600',
                                                        fontSize: '13px',
                                                        display: 'flex',
                                                        alignItems: 'center',
                                                        justifyContent: 'center',
                                                        gap: '6px'
                                                    }}
                                                >
                                                    <DownloadIcon /> Îã§Ïö¥Î°úÎìú
                                                </button>
                                            </div>
                                        </div>

                                        <div style={{ 
                                            background: currentTheme.cardBg, 
                                            padding: '15px', 
                                            borderRadius: '8px'
                                        }}>
                                            <h4 style={{ fontSize: '14px', marginBottom: '8px', marginTop: 0 }}>Îç∞Ïù¥ÌÑ∞ Î≥µÍµ¨</h4>
                                            <p style={{ fontSize: '12px', color: currentTheme.textMuted, marginBottom: '12px', lineHeight: '1.5' }}>
                                                Î∞±ÏóÖÌïú JSON ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïòÏó¨ Îç∞Ïù¥ÌÑ∞Î•º Î≥µÍµ¨Ìï©ÎãàÎã§.
                                            </p>
                                            <input
                                                type="file"
                                                accept=".json"
                                                onChange={importData}
                                                style={{ display: 'none' }}
                                                id="import-file"
                                            />
                                            <label
                                                htmlFor="import-file"
                                                style={{
                                                    display: 'block',
                                                    width: '100%',
                                                    padding: '10px',
                                                    background: '#10b981',
                                                    border: 'none',
                                                    borderRadius: '6px',
                                                    cursor: 'pointer',
                                                    color: '#fff',
                                                    fontWeight: '600',
                                                    fontSize: '13px',
                                                    textAlign: 'center',
                                                    boxSizing: 'border-box'
                                                }}
                                            >
                                                üìÇ ÌååÏùºÏóêÏÑú Î≥µÍµ¨ÌïòÍ∏∞
                                            </label>
                                        </div>

                                        <div style={{ 
                                            marginTop: '15px',
                                            padding: '12px',
                                            background: 'rgba(239, 68, 68, 0.1)',
                                            borderRadius: '8px',
                                            fontSize: '11px',
                                            color: currentTheme.textMuted,
                                            lineHeight: '1.5'
                                        }}>
                                            ‚ö†Ô∏è ÎÖ∏ÏÖò ÏûÑÎ≤†ÎìúÏóêÏÑúÎäî ÌååÏùº Îã§Ïö¥Î°úÎìúÍ∞Ä Ï†úÌïúÎê† Ïàò ÏûàÏäµÎãàÎã§. Î≥µÏÇ¨ Î≤ÑÌäºÏùÑ ÏÇ¨Ïö©Ìï¥Ï£ºÏÑ∏Ïöî.
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<PersonaClock />, document.getElementById('root'));
    </script>
</body>
</html>
